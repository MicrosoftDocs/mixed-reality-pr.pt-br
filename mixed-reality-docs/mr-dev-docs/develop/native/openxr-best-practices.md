---
title: Práticas recomendadas do OpenXR
description: Conheça as práticas recomendadas para qualidade visual, estabilidade e desempenho para seus aplicativos OpenXR.
author: thetuvix
ms.author: alexturn
ms.date: 2/28/2020
ms.topic: article
keywords: OpenXR, Khronos, BasicXRApp, DirectX, nativo, aplicativo nativo, mecanismo personalizado, middleware, práticas recomendadas, desempenho, qualidade, estabilidade
ms.openlocfilehash: ee600cfc22ab1fb7ee43c5727d8e19cf3a1b1463
ms.sourcegitcommit: 2bf79eef6a9b845494484f458443ef4f89d7efc0
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 12/17/2020
ms.locfileid: "97612980"
---
# <a name="openxr-app-best-practices"></a><span data-ttu-id="1bdf5-104">Práticas recomendadas do aplicativo OpenXR</span><span class="sxs-lookup"><span data-stu-id="1bdf5-104">OpenXR app best practices</span></span>

<span data-ttu-id="1bdf5-105">Você pode ver um exemplo das práticas recomendadas abaixo no arquivo OpenXRProgram. cpp do <a href="https://github.com/microsoft/OpenXR-MixedReality/tree/master/samples/BasicXrApp" target="_blank">BasicXrApp</a>.</span><span class="sxs-lookup"><span data-stu-id="1bdf5-105">You can see an example of the best practices below in <a href="https://github.com/microsoft/OpenXR-MixedReality/tree/master/samples/BasicXrApp" target="_blank">BasicXrApp</a>'s OpenXRProgram.cpp file.</span></span> <span data-ttu-id="1bdf5-106">A função Run () no início captura um fluxo de código do aplicativo OpenXR típico da inicialização para o loop de evento e de renderização.</span><span class="sxs-lookup"><span data-stu-id="1bdf5-106">The Run() function at the beginning captures a typical OpenXR app code flow from initialization to the event and rendering loop.</span></span>

## <a name="best-practices-for-visual-quality-and-stability"></a><span data-ttu-id="1bdf5-107">Práticas recomendadas para qualidade visual e estabilidade</span><span class="sxs-lookup"><span data-stu-id="1bdf5-107">Best practices for visual quality and stability</span></span>

<span data-ttu-id="1bdf5-108">As práticas recomendadas nesta seção descrevem como obter a melhor qualidade visual e estabilidade em qualquer aplicativo OpenXR.</span><span class="sxs-lookup"><span data-stu-id="1bdf5-108">The best practices in this section describe how to get the best visual quality and stability in any OpenXR application.</span></span>

<span data-ttu-id="1bdf5-109">Para obter mais recomendações de desempenho específicas para o HoloLens 2, consulte a seção [práticas recomendadas de desempenho no hololens 2](#best-practices-for-performance-on-hololens-2) abaixo.</span><span class="sxs-lookup"><span data-stu-id="1bdf5-109">For further performance recommendations specific to HoloLens 2, see the [Best practices for performance on HoloLens 2](#best-practices-for-performance-on-hololens-2) section below.</span></span>

### <a name="gamma-correct-rendering"></a><span data-ttu-id="1bdf5-110">Gama-renderização correta</span><span class="sxs-lookup"><span data-stu-id="1bdf5-110">Gamma-correct rendering</span></span>

<span data-ttu-id="1bdf5-111">Deve-se ter cuidado para garantir que seu pipeline de renderização seja de gama correto.</span><span class="sxs-lookup"><span data-stu-id="1bdf5-111">Care must be taken to ensure that your rendering pipeline is gamma-correct.</span></span> <span data-ttu-id="1bdf5-112">Ao renderizar para um SwapChain, o formato de exibição de destino de renderização deve corresponder ao formato SwapChain.</span><span class="sxs-lookup"><span data-stu-id="1bdf5-112">When rendering to a swapchain, the render-target view format should match the swapchain format.</span></span> <span data-ttu-id="1bdf5-113">Por exemplo, `DXGI_FORMAT_B8G8R8A8_UNORM_SRGB` para o formato SwapChain e a exibição de destino render.</span><span class="sxs-lookup"><span data-stu-id="1bdf5-113">For example, `DXGI_FORMAT_B8G8R8A8_UNORM_SRGB` for both the swapchain format and the render-target view.</span></span>
<span data-ttu-id="1bdf5-114">Há uma exceção se o pipeline de renderização do aplicativo faz uma conversão manual do sRGB no código do sombreador.</span><span class="sxs-lookup"><span data-stu-id="1bdf5-114">There's an exception if the app's rendering pipeline does a manual sRGB conversion in shader code.</span></span> <span data-ttu-id="1bdf5-115">O aplicativo deve solicitar um formato de SwapChain sRGB, mas usar o formato linear para a exibição de destino de renderização.</span><span class="sxs-lookup"><span data-stu-id="1bdf5-115">The app should request an sRGB swapchain format but use the linear format for the render-target view.</span></span> <span data-ttu-id="1bdf5-116">Por exemplo, solicite `DXGI_FORMAT_B8G8R8A8_UNORM_SRGB` como o formato SwapChain, mas use `DXGI_FORMAT_B8G8R8A8_UNORM` como a exibição de destino de renderização para impedir que o conteúdo seja corrigido de gama duplo.</span><span class="sxs-lookup"><span data-stu-id="1bdf5-116">For example, request `DXGI_FORMAT_B8G8R8A8_UNORM_SRGB` as the swapchain format but use `DXGI_FORMAT_B8G8R8A8_UNORM` as the render-target view to prevent content from being double-gamma corrected.</span></span>

### <a name="submit-depth-buffer-for-projection-layers"></a><span data-ttu-id="1bdf5-117">Enviar buffer de profundidade para camadas de projeção</span><span class="sxs-lookup"><span data-stu-id="1bdf5-117">Submit depth buffer for projection layers</span></span>

<span data-ttu-id="1bdf5-118">Sempre use `XR_KHR_composition_layer_depth` a extensão e envie o buffer de profundidade junto com a camada de projeção ao enviar um quadro para `xrEndFrame` .</span><span class="sxs-lookup"><span data-stu-id="1bdf5-118">Always use `XR_KHR_composition_layer_depth` extension and submit the depth buffer together with the projection layer when submitting a frame to `xrEndFrame`.</span></span>
<span data-ttu-id="1bdf5-119">Habilitar a Reprojeção de profundidade de hardware no HoloLens 2 melhora a estabilidade do holograma.</span><span class="sxs-lookup"><span data-stu-id="1bdf5-119">Enabling hardware depth reprojection on HoloLens 2 improves hologram stability.</span></span>

### <a name="choose-a-reasonable-depth-range"></a><span data-ttu-id="1bdf5-120">Escolher um intervalo de profundidade razoável</span><span class="sxs-lookup"><span data-stu-id="1bdf5-120">Choose a reasonable depth range</span></span>

<span data-ttu-id="1bdf5-121">Prefira um intervalo de profundidade mais estreito para o escopo do conteúdo virtual para ajudar a estabilidade do holograma no HoloLens.</span><span class="sxs-lookup"><span data-stu-id="1bdf5-121">Prefer a narrower depth range to scope the virtual content to help hologram stability on HoloLens.</span></span>
<span data-ttu-id="1bdf5-122">Por exemplo, o exemplo OpenXrProgram. cpp está usando 0,1 metros para 20 metros.</span><span class="sxs-lookup"><span data-stu-id="1bdf5-122">For example, the OpenXrProgram.cpp sample is using 0.1 meters to 20 meters.</span></span>
<span data-ttu-id="1bdf5-123">Use [-Z invertido](https://developer.nvidia.com/content/depth-precision-visualized) para uma resolução de profundidade mais uniforme.</span><span class="sxs-lookup"><span data-stu-id="1bdf5-123">Use [reversed-Z](https://developer.nvidia.com/content/depth-precision-visualized) for a more uniform depth resolution.</span></span>
<span data-ttu-id="1bdf5-124">No HoloLens 2, o uso do `DXGI_FORMAT_D16_UNORM` formato de profundidade preferencial ajudará a obter melhor desempenho e taxa de quadros, embora os buffers de profundidade de 16 bits forneçam uma resolução de menos profundidade que os buffers de profundidade de 24 bits.</span><span class="sxs-lookup"><span data-stu-id="1bdf5-124">On HoloLens 2, using the preferred `DXGI_FORMAT_D16_UNORM` depth format will help achieve better frame rate and performance, although 16-bit depth buffers provide less depth resolution than 24-bit depth buffers.</span></span>
<span data-ttu-id="1bdf5-125">Seguir essas práticas recomendadas para fazer o melhor uso da resolução de profundidade se torna mais importante.</span><span class="sxs-lookup"><span data-stu-id="1bdf5-125">Following these best practices to make best use of the depth resolution becomes more important.</span></span>

### <a name="prepare-for-different-environment-blend-modes"></a><span data-ttu-id="1bdf5-126">Preparar para modos de mesclagem de ambiente diferentes</span><span class="sxs-lookup"><span data-stu-id="1bdf5-126">Prepare for different environment blend modes</span></span>

<span data-ttu-id="1bdf5-127">Se seu aplicativo também for executado em headsets de imersão que bloqueiam completamente o mundo, certifique-se de enumerar modos de mesclagem de ambiente com suporte usando a `xrEnumerateEnvironmentBlendModes` API e prepare o conteúdo de renderização corretamente.</span><span class="sxs-lookup"><span data-stu-id="1bdf5-127">If your application will also run on immersive headsets that completely block out the world, be sure to enumerate supported environment blend modes using `xrEnumerateEnvironmentBlendModes` API, and prepare your rendering content correctly.</span></span>
<span data-ttu-id="1bdf5-128">Por exemplo, para um sistema com como `XR_ENVIRONMENT_BLEND_MODE_ADDITIVE` o HoloLens, o aplicativo deve usar transparente como a cor clara, enquanto para um sistema com `XR_ENVIRONMENT_BLEND_MODE_OPAQUE` , o aplicativo deve renderizar alguma cor opaca ou alguma sala virtual em segundo plano.</span><span class="sxs-lookup"><span data-stu-id="1bdf5-128">For example, for a system with `XR_ENVIRONMENT_BLEND_MODE_ADDITIVE` such as the HoloLens, the app should use transparent as the clear color, while for a system with `XR_ENVIRONMENT_BLEND_MODE_OPAQUE`, the app should render some opaque color or some virtual room in the background.</span></span>

### <a name="choose-unbounded-reference-space-as-applications-root-space"></a><span data-ttu-id="1bdf5-129">Escolher o espaço de referência não associado como espaço raiz do aplicativo</span><span class="sxs-lookup"><span data-stu-id="1bdf5-129">Choose unbounded reference space as application's root space</span></span>

<span data-ttu-id="1bdf5-130">Normalmente, os aplicativos estabelecem algum espaço de coordenadas do mundo raiz para conectar modos de exibição, ações e hologramas juntos.</span><span class="sxs-lookup"><span data-stu-id="1bdf5-130">Applications typically establish some root world coordinate space to connect views, actions, and holograms together.</span></span>
<span data-ttu-id="1bdf5-131">Use `XR_REFERENCE_SPACE_TYPE_UNBOUNDED_MSFT` quando a extensão tiver suporte para estabelecer um [sistema de coordenadas de escala mundial](../../design/coordinate-systems.md#building-a-world-scale-experience), permitindo que seu aplicativo Evite descompassos de holograma indesejados quando o usuário se mover para longe (por exemplo, 5 metros de distância) de onde o aplicativo é iniciado.</span><span class="sxs-lookup"><span data-stu-id="1bdf5-131">Use `XR_REFERENCE_SPACE_TYPE_UNBOUNDED_MSFT` when the extension is supported to establish a [world-scale coordinate system](../../design/coordinate-systems.md#building-a-world-scale-experience), enabling your app to avoid undesired hologram drift when the user moves far (for example, 5 meters away) from where the app starts.</span></span>
<span data-ttu-id="1bdf5-132">Use `XR_REFERENCE_SPACE_TYPE_LOCAL` como um fallback se a extensão de espaço não associado não existir.</span><span class="sxs-lookup"><span data-stu-id="1bdf5-132">Use `XR_REFERENCE_SPACE_TYPE_LOCAL` as a fallback if the unbounded space extension doesn't exist.</span></span>

### <a name="associate-hologram-with-spatial-anchor"></a><span data-ttu-id="1bdf5-133">Associar holograma a âncora espacial</span><span class="sxs-lookup"><span data-stu-id="1bdf5-133">Associate hologram with spatial anchor</span></span>

<span data-ttu-id="1bdf5-134">Ao usar um espaço de referência não associado, os hologramas que você coloca diretamente no espaço de referência [podem cair conforme o usuário percorre as salas distantes e, em seguida, retorna](../../design/coordinate-systems.md#building-a-world-scale-experience).</span><span class="sxs-lookup"><span data-stu-id="1bdf5-134">When using an unbounded reference space, holograms you place directly in that reference space [may drift as the user walks to distant rooms and then comes back](../../design/coordinate-systems.md#building-a-world-scale-experience).</span></span>
<span data-ttu-id="1bdf5-135">Para usuários com holograma, coloque em um local discreto no mundo, [crie uma âncora espacial](../../design/spatial-anchors.md#best-practices) usando a `xrCreateSpatialAnchorSpaceMSFT` função de extensão e posicione o holograma em sua origem.</span><span class="sxs-lookup"><span data-stu-id="1bdf5-135">For hologram users place at a discrete location in the world, [create a spatial anchor](../../design/spatial-anchors.md#best-practices) using the `xrCreateSpatialAnchorSpaceMSFT` extension function and position the hologram at its origin.</span></span> <span data-ttu-id="1bdf5-136">Isso manterá esse holograma independentemente estável ao longo do tempo.</span><span class="sxs-lookup"><span data-stu-id="1bdf5-136">That will keep that hologram independently stable over time.</span></span>

### <a name="support-mixed-reality-capture"></a><span data-ttu-id="1bdf5-137">Suporte à captura de realidade misturada</span><span class="sxs-lookup"><span data-stu-id="1bdf5-137">Support mixed reality capture</span></span>

<span data-ttu-id="1bdf5-138">Embora a exibição principal do HoloLens 2 Use a mistura de ambiente aditivo, quando o usuário inicia a [captura de realidade misturada](../platform-capabilities-and-apis/mixed-reality-capture-for-developers.md), o conteúdo de renderização do aplicativo será misturado com o fluxo de vídeo do ambiente.</span><span class="sxs-lookup"><span data-stu-id="1bdf5-138">Although HoloLens 2's primary display uses additive environment blending, when the user starts [mixed reality capture](../platform-capabilities-and-apis/mixed-reality-capture-for-developers.md), the app's rendering content will be alpha-blended with the environment video stream.</span></span>
<span data-ttu-id="1bdf5-139">Para obter a melhor qualidade visual em vídeos de captura de realidade misturada, é melhor definir o `XR_COMPOSITION_LAYER_BLEND_TEXTURE_SOURCE_ALPHA_BIT` na camada de projeção `layerFlags` .</span><span class="sxs-lookup"><span data-stu-id="1bdf5-139">To achieve the best visual quality in mixed reality capture videos, it's best to set the `XR_COMPOSITION_LAYER_BLEND_TEXTURE_SOURCE_ALPHA_BIT` in your projection layer's `layerFlags`.</span></span>

## <a name="best-practices-for-performance-on-hololens-2"></a><span data-ttu-id="1bdf5-140">Práticas recomendadas para o desempenho no HoloLens 2</span><span class="sxs-lookup"><span data-stu-id="1bdf5-140">Best practices for performance on HoloLens 2</span></span>

<span data-ttu-id="1bdf5-141">Como um dispositivo móvel com suporte à Reprojeção de hardware, o HoloLens 2 tem requisitos mais estritos para o desempenho ideal.</span><span class="sxs-lookup"><span data-stu-id="1bdf5-141">As a mobile device with hardware reprojection support, HoloLens 2 has stricter requirements for optimal performance.</span></span>  <span data-ttu-id="1bdf5-142">Há várias maneiras de enviar dados de composição por meio de, o que resulta em pós-processamento com uma penalidade de desempenho perceptível.</span><span class="sxs-lookup"><span data-stu-id="1bdf5-142">There are a number of ways to submit composition data through, which results in post-processing with a noticeable performance penalty.</span></span>

### <a name="select-a-swapchain-format"></a><span data-ttu-id="1bdf5-143">Selecionar um formato SwapChain</span><span class="sxs-lookup"><span data-stu-id="1bdf5-143">Select a swapchain format</span></span>

<span data-ttu-id="1bdf5-144">Sempre enumere os formatos de pixel com suporte usando e `xrEnumerateSwapchainFormats` escolha o primeiro formato de cor e profundidade de pixel do tempo de execução ao qual o aplicativo dá suporte, pois é isso que o tempo de execução prefere para o desempenho ideal.</span><span class="sxs-lookup"><span data-stu-id="1bdf5-144">Always enumerate supported pixel formats using `xrEnumerateSwapchainFormats`, and choose the first color and depth pixel format from the runtime that the app supports, because that's what the runtime prefers for optimal performance.</span></span> <span data-ttu-id="1bdf5-145">Observe, no HoloLens 2, `DXGI_FORMAT_B8G8R8A8_UNORM_SRGB` e `DXGI_FORMAT_D16_UNORM` normalmente é a primeira opção para obter um melhor desempenho de renderização.</span><span class="sxs-lookup"><span data-stu-id="1bdf5-145">Note, on HoloLens 2, `DXGI_FORMAT_B8G8R8A8_UNORM_SRGB` and `DXGI_FORMAT_D16_UNORM` is typically the first choice to achieve better rendering performance.</span></span> <span data-ttu-id="1bdf5-146">Essa preferência pode ser diferente nos headsets de VR em execução em um PC desktop, em que os buffers de profundidade de 24 bits têm menos impacto no desempenho.</span><span class="sxs-lookup"><span data-stu-id="1bdf5-146">This preference can be different on VR headsets running on a Desktop PC, where 24-bit depth buffers have less of a performance impact.</span></span>
  
<span data-ttu-id="1bdf5-147">**Aviso de desempenho:** Usar um formato diferente do formato de cor SwapChain primário resultará em pós-processamento do tempo de execução, o que acarreta uma penalidade de desempenho significativa.</span><span class="sxs-lookup"><span data-stu-id="1bdf5-147">**Performance Warning:** Using a format other than the primary swapchain color format will result in runtime post-processing, which comes at a significant performance penalty.</span></span>

### <a name="render-with-recommended-rendering-parameters-and-frame-timing"></a><span data-ttu-id="1bdf5-148">Renderizar com os parâmetros de renderização recomendados e o tempo de quadro</span><span class="sxs-lookup"><span data-stu-id="1bdf5-148">Render with recommended rendering parameters and frame timing</span></span>

<span data-ttu-id="1bdf5-149">Sempre renderizar com a largura/altura da configuração de exibição recomendada ( `recommendedImageRectWidth` e `recommendedImageRectHeight` de `XrViewConfigurationView` ) e sempre usar a `xrLocateViews` API para consultar a exibição recomendada, FOV e outros parâmetros de renderização antes da renderização.</span><span class="sxs-lookup"><span data-stu-id="1bdf5-149">Always render with the recommended view configuration width/height (`recommendedImageRectWidth` and `recommendedImageRectHeight` from `XrViewConfigurationView`), and always use `xrLocateViews` API to query for the recommended view pose, FOV, and other rendering parameters before rendering.</span></span>
<span data-ttu-id="1bdf5-150">Sempre use a `XrFrameEndInfo.predictedDisplayTime` da chamada mais recente `xrWaitFrame` ao consultar poses e exibições.</span><span class="sxs-lookup"><span data-stu-id="1bdf5-150">Always use the `XrFrameEndInfo.predictedDisplayTime` from the latest `xrWaitFrame` call when querying for poses and views.</span></span>
<span data-ttu-id="1bdf5-151">Isso permite que o HoloLens ajuste a renderização e otimize a qualidade visual para a pessoa que está desgastando o HoloLens.</span><span class="sxs-lookup"><span data-stu-id="1bdf5-151">This allows HoloLens to adjust rendering and optimize visual quality for the person who is wearing the HoloLens.</span></span>

### <a name="use-a-single-projection-layer"></a><span data-ttu-id="1bdf5-152">Usar uma única camada de projeção</span><span class="sxs-lookup"><span data-stu-id="1bdf5-152">Use a single projection layer</span></span>

<span data-ttu-id="1bdf5-153">O HoloLens 2 tem energia limitada de GPU para renderizar conteúdo e um compositor de hardware otimizado para uma única camada de projeção.</span><span class="sxs-lookup"><span data-stu-id="1bdf5-153">HoloLens 2 has limited GPU power for rendering content and a hardware compositor optimized for a single projection layer.</span></span>
<span data-ttu-id="1bdf5-154">Sempre usar uma única camada de projeção pode ajudar a taxa de quadros, a estabilidade do holograma e a qualidade visual do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="1bdf5-154">Always using a single projection layer can help the application's framerate, hologram stability and visual quality.</span></span>  
  
<span data-ttu-id="1bdf5-155">**Aviso de desempenho:** O envio de qualquer coisa, exceto uma única camada de proteção, resultará em pós-processamento do tempo de execução, o que acarreta uma penalidade de desempenho significativa.</span><span class="sxs-lookup"><span data-stu-id="1bdf5-155">**Performance Warning:** Submitting anything but a single protection layer will result in runtime post-processing, which comes at a significant performance penalty.</span></span>

### <a name="render-with-texture-array-and-vprt"></a><span data-ttu-id="1bdf5-156">Renderizar com matriz de textura e VPRT</span><span class="sxs-lookup"><span data-stu-id="1bdf5-156">Render with texture array and VPRT</span></span>

<span data-ttu-id="1bdf5-157">Crie um `xrSwapchain` para os olhos esquerdo e direito usando `arraySize=2` para SwapChain de cor e outro para profundidade.</span><span class="sxs-lookup"><span data-stu-id="1bdf5-157">Create one `xrSwapchain` for both left and right eye using `arraySize=2` for color swapchain, and one for depth.</span></span>
<span data-ttu-id="1bdf5-158">Renderize o olho esquerdo na fatia 0 e no olho certo para a fatia 1.</span><span class="sxs-lookup"><span data-stu-id="1bdf5-158">Render the left eye into slice 0 and the right eye into slice 1.</span></span>
<span data-ttu-id="1bdf5-159">Use um sombreador com VPRT e chamadas de desenho em instância para a renderização estereoscópico para minimizar a carga de GPU.</span><span class="sxs-lookup"><span data-stu-id="1bdf5-159">Use a shader with VPRT and instanced draw calls for stereoscopic rendering to minimize GPU load.</span></span>
<span data-ttu-id="1bdf5-160">Isso também permite que a otimização do tempo de execução alcance o melhor desempenho no HoloLens 2.</span><span class="sxs-lookup"><span data-stu-id="1bdf5-160">This also enables the runtime's optimization to achieve the best performance on HoloLens 2.</span></span>
<span data-ttu-id="1bdf5-161">Alternativas ao uso de uma matriz de textura, como renderização em toda a parte ou uma SwapChain separada por olho, resultarão no pós-processamento do tempo de execução, o que acarreta uma penalidade de desempenho significativa.</span><span class="sxs-lookup"><span data-stu-id="1bdf5-161">Alternatives to using a texture array, such as double-wide rendering or a separate swapchain per eye, will result in runtime post-processing, which comes at a significant performance penalty.</span></span>

### <a name="avoid-quad-layers"></a><span data-ttu-id="1bdf5-162">Evitar camadas quádruplas</span><span class="sxs-lookup"><span data-stu-id="1bdf5-162">Avoid quad layers</span></span>

<span data-ttu-id="1bdf5-163">Em vez de enviar camadas quádruplas como camadas de composição com `XrCompositionLayerQuad` , processe o conteúdo Quad diretamente na projeção SwapChain.</span><span class="sxs-lookup"><span data-stu-id="1bdf5-163">Rather than submitting quad layers as composition layers with `XrCompositionLayerQuad`, render the quad content directly into the projection swapchain.</span></span>

<span data-ttu-id="1bdf5-164">**Aviso de desempenho:** Fornecer camadas adicionais além de uma única camada de projeção, como camadas quádruplas, resultará em pós-processamento do tempo de execução, o que acarreta uma penalidade de desempenho significativa.</span><span class="sxs-lookup"><span data-stu-id="1bdf5-164">**Performance Warning:** Providing additional layers beyond a single projection layer, such as quad layers, will result in runtime post-processing, which comes at a significant performance penalty.</span></span>